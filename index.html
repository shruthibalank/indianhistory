<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian History Archive</title>
    <style>
        /* --- THEME & COLORS --- */
        :root {
            --bg-color: #fdf5e6;         /* Parchment / Light Beige */
            --primary-color: #2c3e50;    /* Ink Blue / Dark Slate */
            --accent-color: #8b0000;     /* Deep Red / Maroon */
            --highlight-color: #d4af37;  /* Gold */
            --text-color: #2c3e50;
            --box-bg: #ffffff;
            --border-radius: 8px;
        }

        body {
            font-family: 'Georgia', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        /* --- NAVIGATION TABS --- */
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary-color);
            transition: 0.3s;
            border-radius: 10px 10px 0 0;
        }

        .tab-button:hover {
            background-color: rgba(44, 62, 80, 0.1);
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: var(--bg-color);
        }

        /* --- CONTENT AREAS --- */
        .tab-content {
            display: none;
            max-width: 1000px;
            margin: 0 auto;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* --- TAB 1: MAP & STATES --- */
        .map-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .map-container img {
            max-width: 100%;
            height: auto;
            border: 5px solid var(--primary-color);
            border-radius: var(--border-radius);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
        }

        .year-search {
            text-align: center;
            margin: 20px 0;
        }

        .year-search input {
            padding: 10px;
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            width: 200px;
        }

        .states-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .state-card {
            background-color: var(--box-bg);
            border: 1px solid var(--primary-color);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: 0.2s;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }

        .state-card:hover {
            transform: translateY(-3px);
            background-color: var(--primary-color);
            color: white;
        }

        .state-card.highlighted {
            background-color: var(--accent-color);
            color: white;
            border: 2px solid var(--highlight-color);
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* --- TAB 2: GLOBAL TIMELINE --- */
        .filter-section {
            text-align: center;
            margin-bottom: 20px;
        }
        
        select {
            padding: 8px;
            font-size: 16px;
            border-radius: var(--border-radius);
        }

        /* --- TAB 3: NOTES --- */
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .note-card {
            background-color: #fff8dc; /* Cornsilk color for notes */
            border: 1px solid #d2b48c;
            padding: 20px;
            border-radius: var(--border-radius);
            position: relative;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.1);
        }

        .add-note-btn {
            display: block;
            margin: 20px auto;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 20px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
        }

        /* --- TAB 4: ABOUT (Harry Potter Style) --- */
        .about-container {
            background-color: #2b1d16; /* Dark wood color */
            color: #f0e6d2;
            padding: 40px;
            border-radius: var(--border-radius);
            text-align: center;
            border: 4px double var(--highlight-color);
        }

        .about-container img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid var(--highlight-color);
            object-fit: cover;
            margin-bottom: 20px;
        }

        .hp-font {
            font-family: 'Courier New', Courier, monospace; /* Typewriter style */
            font-style: italic;
        }

        /* --- MODALS --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
        }

        .modal-content {
            background-color: var(--bg-color);
            margin: 10% auto;
            padding: 30px;
            border: 2px solid var(--primary-color);
            width: 50%;
            max-width: 500px;
            border-radius: var(--border-radius);
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            box-sizing: border-box;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button.btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-secondary { background-color: #95a5a6; color: white; }

        /* --- VERTICAL TIMELINE STYLING --- */
        .timeline {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .timeline::after {
            content: '';
            position: absolute;
            width: 4px;
            background-color: var(--primary-color);
            top: 0;
            bottom: 0;
            left: 20px;
        }

        .timeline-item {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            right: auto;
            left: 14px;
            top: 15px;
            background-color: var(--bg-color);
            border: 3px solid var(--accent-color);
            border-radius: 50%;
            z-index: 1;
        }

        .timeline-content {
            padding: 15px;
            background-color: white;
            border-radius: 6px;
            border-left: 5px solid var(--accent-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative; /* Needed for delete button positioning */
        }

        .year-badge {
            font-weight: bold;
            color: var(--accent-color);
            font-size: 1.1em;
        }
        
        .state-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        /* --- DELETE BUTTON STYLE --- */
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: var(--accent-color);
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.5;
            transition: 0.3s;
        }

        .delete-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }
    </style>
</head>
<body>

    <div class="tab-container">
        <button class="tab-button active" onclick="openTab('tab-map')">India Map</button>
        <button class="tab-button" onclick="openTab('tab-timeline')">Timeline</button>
        <button class="tab-button" onclick="openTab('tab-notes')">Notes</button>
        <button class="tab-button" onclick="openTab('tab-about')">About</button>
    </div>

    <div id="tab-map" class="tab-content active">
        <div class="map-container">
            <img src="image.png" alt="Map of India">
        </div>
        
        <div class="year-search">
            <input type="number" id="yearInput" placeholder="Enter Year (e.g., 1947)" oninput="highlightStatesByYear()">
        </div>

        <h3>Select a Region:</h3>
        <div class="states-grid" id="statesGrid"></div>
    </div>

    <div id="tab-timeline" class="tab-content">
        <div class="filter-section">
            <label for="stateFilter">Filter by State: </label>
            <select id="stateFilter" onchange="renderGlobalTimeline()">
                <option value="All">All States</option>
            </select>
        </div>
        <div class="timeline" id="globalTimeline"></div>
    </div>

    <div id="tab-notes" class="tab-content">
        <button class="add-note-btn" onclick="openNoteModal()">+</button>
        <div class="notes-grid" id="notesGrid"></div>
    </div>

    <div id="tab-about" class="tab-content">
        <div class="about-container">
            <img src="shru.png" alt="Shru">
            <h2>The Keeper of the Chronicles</h2>
            <p class="hp-font">"I solemnly swear that I am up to no good."</p>
            <p>
                Welcome, Muggle or Wizard, to the Archives. I am Shru, Head Archivist of this digital Pensieve. 
                When I am not fighting Dementors (bugs in my code) or brewing Felix Felicis, 
                I am carefully documenting the history of the realm. 
                <br><br>
                Use this map wisely. Mischief Managed!
            </p>
        </div>
    </div>

    <div id="stateActionModal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <span class="close-btn" onclick="closeModal('stateActionModal')">&times;</span>
            <h2 id="selectedStateName">State Name</h2>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="openViewEvents()">View Timeline</button>
                <button class="btn btn-secondary" onclick="openAddEvent()">Add Event</button>
            </div>
        </div>
    </div>

    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('addEventModal')">&times;</span>
            <h3>Add Event</h3>
            <div class="form-group">
                <label>Time Period (Year):</label>
                <input type="number" id="eventYear" placeholder="-300 for 300 BC, 1947 for AD">
            </div>
            <div class="form-group">
                <label>Location:</label>
                <input type="text" id="eventLocation" readonly>
            </div>
            <div class="form-group">
                <label>Event:</label>
                <input type="text" id="eventTitle">
            </div>
            <div class="form-group">
                <label>Notes:</label>
                <textarea id="eventNotes" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveEvent()">Add to Timeline</button>
                <button class="btn btn-secondary" onclick="closeModal('addEventModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="viewStateModal" class="modal">
        <div class="modal-content" style="width: 80%; max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <span class="close-btn" onclick="closeModal('viewStateModal')">&times;</span>
            <h3 id="viewStateTitle">Timeline</h3>
            <div class="timeline" id="stateTimelineContent"></div>
        </div>
    </div>

    <div id="addNoteModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('addNoteModal')">&times;</span>
            <h3>Add Quick Note</h3>
            <div class="form-group">
                <label>Year:</label>
                <input type="number" id="noteYear">
            </div>
            <div class="form-group">
                <label>Note:</label>
                <textarea id="noteText" rows="4"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveNote()">Save Note</button>
                <button class="btn btn-secondary" onclick="closeModal('addNoteModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA INITIALIZATION ---
        const statesList = [
            "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa", "Gujarat", 
            "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh", 
            "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", 
            "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", 
            "West Bengal", 
            "Andaman and Nicobar Islands", "Chandigarh", "Dadra and Nagar Haveli and Daman and Diu", 
            "Delhi", "Jammu and Kashmir", "Ladakh", "Lakshadweep", "Puducherry"
        ];

        let eventsData = JSON.parse(localStorage.getItem('historyEvents')) || [];
        let notesData = JSON.parse(localStorage.getItem('historyNotes')) || [];
        let currentSelectedState = "";

        // --- DOM ELEMENTS & SETUP ---
        const statesGrid = document.getElementById('statesGrid');
        const stateFilter = document.getElementById('stateFilter');

        function init() {
            statesList.forEach(state => {
                const btn = document.createElement('div');
                btn.className = 'state-card';
                btn.innerText = state;
                btn.dataset.state = state; 
                btn.onclick = () => openStateAction(state);
                statesGrid.appendChild(btn);

                const opt = document.createElement('option');
                opt.value = state;
                opt.innerText = state;
                stateFilter.appendChild(opt);
            });

            renderGlobalTimeline();
            renderNotes();
        }

        // --- TABS LOGIC ---
        function openTab(tabName) {
            const contents = document.getElementsByClassName('tab-content');
            for(let content of contents) content.classList.remove('active');
            
            const btns = document.getElementsByClassName('tab-button');
            for(let btn of btns) btn.classList.remove('active');

            document.getElementById(tabName).classList.add('active');
            
            Array.from(btns).forEach(b => {
                if(b.onclick.toString().includes(tabName)) b.classList.add('active');
            });

            if(tabName === 'tab-timeline') renderGlobalTimeline();
        }

        // --- MODAL LOGIC ---
        function openStateAction(state) {
            currentSelectedState = state;
            document.getElementById('selectedStateName').innerText = state;
            document.getElementById('stateActionModal').style.display = 'block';
        }

        function openAddEvent() {
            closeModal('stateActionModal');
            document.getElementById('eventLocation').value = currentSelectedState;
            document.getElementById('eventYear').value = "";
            document.getElementById('eventTitle').value = "";
            document.getElementById('eventNotes').value = "";
            document.getElementById('addEventModal').style.display = 'block';
        }

        function openViewEvents() {
            closeModal('stateActionModal');
            document.getElementById('viewStateTitle').innerText = "History of " + currentSelectedState;
            renderStateTimeline(currentSelectedState);
            document.getElementById('viewStateModal').style.display = 'block';
        }

        // --- HIGHLIGHTING LOGIC ---
        function highlightStatesByYear() {
            const year = parseInt(document.getElementById('yearInput').value);
            const cards = document.getElementsByClassName('state-card');
            
            Array.from(cards).forEach(card => card.classList.remove('highlighted'));

            if (isNaN(year)) return;

            const activeStates = eventsData
                .filter(e => parseInt(e.year) === year)
                .map(e => e.location);

            Array.from(cards).forEach(card => {
                if (activeStates.includes(card.dataset.state)) {
                    card.classList.add('highlighted');
                }
            });
        }

        // --- DATA MANAGEMENT: EVENTS ---
        function saveEvent() {
            const year = document.getElementById('eventYear').value;
            const location = document.getElementById('eventLocation').value;
            const title = document.getElementById('eventTitle').value;
            const note = document.getElementById('eventNotes').value;

            if(!year || !title) {
                alert("Please fill in Year and Event at least.");
                return;
            }

            const newEvent = {
                id: Date.now(), // Unique ID for deletion
                year: parseInt(year),
                location: location,
                title: title,
                note: note
            };

            eventsData.push(newEvent);
            localStorage.setItem('historyEvents', JSON.stringify(eventsData));
            
            closeModal('addEventModal');
            renderGlobalTimeline();
            alert("Event Added to History!");
        }

        // --- NEW: DELETE EVENT FUNCTION ---
        function deleteEvent(id) {
            if(confirm("Are you sure you want to burn this record from the archives?")) {
                eventsData = eventsData.filter(e => e.id !== id);
                localStorage.setItem('historyEvents', JSON.stringify(eventsData));
                
                // Refresh all views
                renderGlobalTimeline();
                
                // If the state modal is open, refresh that too
                if(document.getElementById('viewStateModal').style.display === 'block') {
                    renderStateTimeline(currentSelectedState);
                }
            }
        }

        // --- RENDERING EVENTS ---
        function formatYear(y) {
            return y < 0 ? Math.abs(y) + " BC" : y + " AD";
        }

        function createTimelineHTML(events) {
            if(events.length === 0) return "<p style='text-align:center'>No events recorded yet.</p>";
            
            events.sort((a, b) => a.year - b.year);

            let html = "";
            events.forEach(e => {
                html += `
                <div class="timeline-item">
                    <div class="timeline-content">
                        <button class="delete-btn" onclick="deleteEvent(${e.id})" title="Delete Record">&times;</button>
                        <span class="year-badge">${formatYear(e.year)}</span> 
                        ${e.location ? `<span class="state-badge">${e.location}</span>` : ''}
                        <h4>${e.title}</h4>
                        <p>${e.note}</p>
                    </div>
                </div>`;
            });
            return html;
        }

        function renderStateTimeline(state) {
            const filtered = eventsData.filter(e => e.location === state);
            document.getElementById('stateTimelineContent').innerHTML = createTimelineHTML(filtered);
        }

        function renderGlobalTimeline() {
            const filterVal = document.getElementById('stateFilter').value;
            let filtered = eventsData;
            
            if (filterVal !== "All") {
                filtered = eventsData.filter(e => e.location === filterVal);
            }
            
            document.getElementById('globalTimeline').innerHTML = createTimelineHTML(filtered);
        }

        // --- DATA MANAGEMENT: NOTES ---
        function openNoteModal() {
            document.getElementById('noteYear').value = "";
            document.getElementById('noteText').value = "";
            document.getElementById('addNoteModal').style.display = 'block';
        }

        function saveNote() {
            const year = document.getElementById('noteYear').value;
            const text = document.getElementById('noteText').value;

            if(!year || !text) return;

            const newNote = {
                id: Date.now(), // Unique ID for deletion
                year: parseInt(year),
                text: text
            };

            notesData.push(newNote);
            notesData.sort((a, b) => a.year - b.year);
            localStorage.setItem('historyNotes', JSON.stringify(notesData));
            
            renderNotes();
            closeModal('addNoteModal');
        }

        // --- NEW: DELETE NOTE FUNCTION ---
        function deleteNote(id) {
            if(confirm("Are you sure you want to discard this note?")) {
                notesData = notesData.filter(n => n.id !== id);
                localStorage.setItem('historyNotes', JSON.stringify(notesData));
                renderNotes();
            }
        }

        function renderNotes() {
            const grid = document.getElementById('notesGrid');
            grid.innerHTML = "";
            
            notesData.forEach(n => {
                const div = document.createElement('div');
                div.className = 'note-card';
                div.innerHTML = `
                    <button class="delete-btn" onclick="deleteNote(${n.id})" title="Delete Note">&times;</button>
                    <h3>${formatYear(n.year)}</h3>
                    <p>${n.text}</p>
                `;
                grid.appendChild(div);
            });
        }

        // --- UTILS ---
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
            }
        }

        init();
    </script>
</body>
</html>